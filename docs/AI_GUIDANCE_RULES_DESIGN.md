# AI 指导规则（.cursorrules）：设计原则

## 1. 简介

`CursorMate` MCP (My Context Provider) 服务器的核心功能之一是为 AI 助手（如 Cursor）提供有效指导，确保生成的代码符合项目特定的标准、模式和最佳实践。这是 `.cursorrules` 概念的演进，从静态文件发展为 MCP 服务器内动态管理的指导原则集合。

本文档概述了这些 AI 指导规则的设计原则、期望内容、生成策略和集成考虑因素。它从以前的特定实现（如 `CursorFocus` 的 `rules_generator.py`）中抽象出来，为 MCP 服务器定义概念框架。

## 2. 核心目标

AI 指导规则旨在：
- **引导 AI 行为**：指导 AI 代码生成、解释和重构以遵循项目规范
- **提高代码质量与一致性**：确保 AI 生成的代码符合项目既定的风格、模式和架构选择
- **减少返工**：最小化开发者手动纠正不符合项目上下文的 AI 输出的需要
- **编码项目知识**：捕获显式和隐式的开发约定供 AI 使用

## 3. 期望内容与结构（概念性）

AI 指导规则应该结构化，便于 MCP 服务器解析并转换为有效的提示或 AI 上下文。内容可以分为以下类别：

### 3.1. 📝 编码标准与风格
- **命名约定**：变量、函数、类、模块、文件的命名（如变量使用 `camelCase`，类使用 `PascalCase`）
- **格式偏好**：行长度、缩进、空白使用、大括号风格（虽然通常由格式化工具处理，但可以强化）
- **注释风格**：注释、文档字符串的首选格式（如 JSDoc、reStructuredText）
- **语言特定习语**：鼓励使用特定语言特性或构造（如"在 JavaScript 中优先使用 `async/await` 而非 Promise 链"）

### 3.2. 🏗️ 架构与设计模式
- **首选模式**：项目中积极使用和鼓励的设计模式列表（如"数据访问使用仓储模式"，"前端状态管理使用 Redux"）。包含简要描述或内部文档链接
- **要避免/不鼓励的模式**：在项目中被视为反模式或正在弃用的模式（如"尽可能避免单例模式"，"不鼓励深度继承"）
- **模块/组件结构**：新模块或组件应如何结构化的指导原则，特定类型文件的放置位置（如"服务应放在 `src/services` 中"）
- **API 设计原则**：（如适用）API 端点命名、请求/响应格式、版本控制、认证方法的约定

### 3.3. ✅ 最佳实践与约定
- **错误处理**：错误处理的首选方法（如"使用自定义错误类"，"在特定模块中返回错误代码 vs 抛出异常"）
- **日志记录**：记录什么、日志级别和日志消息格式的指导原则
- **测试**：单元测试、集成测试的期望（如"所有公共方法必须有单元测试"，"模拟外部依赖"）
- **安全考虑**：要遵循的特定安全实践（如"清理所有用户输入"，"SQL 查询使用预处理语句"）
- **性能优化**：常见性能提示或需要注意的已知瓶颈
- **依赖使用**：添加新依赖的指导原则，常见任务的首选库

### 3.4. 🌐 领域特定知识与术语
- **术语表**：关键业务领域术语及其在代码中的接受定义或使用
- **核心抽象**：项目特定的基本抽象或概念的解释

### 3.5. 💡 通用 AI 交互指导原则
- **解释的语调与风格**：如"偏好简洁直接的解释"
- **代码生成偏好**：如"生成函数时，始终包含类型提示"，"为所有公共函数提供文档字符串"

## 4. 生成、管理与更新策略（概念性）

- **手动策划**：这些规则的很大一部分可能由开发团队手动定义和策划，因为它们代表特定的选择和知识
- **AI 辅助生成**：MCP 服务器可以利用 AI（如 Gemini）来：
    - **建议规则**：基于现有代码库的静态分析（如推断命名约定、常见模式）
    - **起草规则**：从开发者提供的高级描述中
    - **完善规则**：提高手动编写规则的清晰度和简洁性
- **静态分析集成**：MCP 服务器可以运行代码检查器或自定义静态分析检查来识别常见模式或违规，然后可以为规则创建或验证提供信息
- **版本控制**：规则应与项目一起进行版本控制或在 MCP 服务器的配置中
- **动态加载与作用域**：MCP 服务器应能够根据当前项目甚至项目的特定部分加载适当的规则集
- **用户界面**：可以提供 UI 来管理、编辑和审查这些规则

## 5. 与 AI 助手的集成（如 Cursor）

MCP 服务器将打包这些规则和项目概览上下文（`PROJECT_OVERVIEW_DESIGN.md`）为 AI 提供丰富、定制的上下文。这可能涉及：
- **系统提示**：构建包含这些规则的详细系统提示
- **上下文片段**：当用户询问问题或请求与项目特定部分相关的代码生成时，注入相关规则作为上下文
- **微调（未来）**：可能将这些规则用作特定项目或组织模型微调数据集的一部分

## 6. 提示工程考虑因素

有效的提示工程对于将这些规则转换为 AI 行动至关重要：
- **清晰性与无歧义性**：规则必须写得清楚，避免 AI 误解
- **可操作性**：规则应以 AI 可以据此行动的方式表述
- **优先级与冲突解决**：系统可能需要一种方式来优先处理规则或处理冲突（如果出现）
- **基于示例的提示**：在规则旁边提供好的和坏的示例可以显著提高 AI 的遵循度

这个概念设计将指导 `CursorMate` MCP 服务器中 AI 指导规则功能的开发，形成其提供真正个性化和上下文感知 AI 辅助能力的关键部分。 